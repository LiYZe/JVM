# 内存

## 区域划分

<div align="center"><img src="https://user-images.githubusercontent.com/37955886/116332189-df521980-a803-11eb-94d0-a76b9477969d.png"/></div> 

### 程序计数器

存储指向下一条指令的地址，确定下一条执行的字节码指令。

每条线程都有一个独立的程序计数器。

无OutOfMemoryError情况。

### 虚拟机栈

线程私有，生命周期与线程相同。

在方法被执行的时候，虚拟机创建一个帧栈用于存放局部变量表等信息。

#### 局部变量表

存放基本数据类型、对象引用地址。

存储空间以局部变量槽表示。

### 本地方法栈

使用本地方法服务。

### Java堆

所有线程共享。存放对象实例。物理上可以不连续，但是逻辑上连续。
 
### 方法区

所有线程共享。存放编译器编译后的代码缓存等数据。不需要连续内存
 
#### 运行时常量池

常量池表，存放编译期生成的各种字面量和符号引用， 在类加载后放到方法区的运行时常量池中。

### 直接内存

基于通道与缓冲区的I/O方式。

## 创建对象

### new

1.检查该指令参数能否在常量池中确定一个类的符号引用，类是否加载、解析、初始化

2.虚拟机为新对象分配内存。指针碰撞或者空闲列表方法

3.内存空间初始化为0

4.根据对象头设置对象

### 内存布局

存储布局三个部分：对象头、实例数据和对齐填充

#### 头对象

存储对象自身的运行时数据+类型指针（用于确定对象属于哪个类的实例）

#### 实例数据

字段内容

#### 对齐填充

占位符

### 访问定位

### 句柄

reference指向句柄池，句柄池指向实对象的实例和类型数据。

### 指针访问

reference直接指向对象实例数据，再指向对象类型数据。













 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
